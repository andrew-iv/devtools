<Project TreatAsLocalProperty="TaskAssembly">

  <PropertyGroup>
    <TaskAssembly>$(MSBuildThisFileDirectory)Vostok.Tools.GitCommit2AssemblyTitle.dll</TaskAssembly>
  </PropertyGroup>

  <PropertyGroup>
    <GenerateAssemblyTitleAttribute>false</GenerateAssemblyTitleAttribute>
    <GenerateAssemblyInformationalVersionAttribute>false</GenerateAssemblyInformationalVersionAttribute>
  </PropertyGroup>

  <UsingTask TaskName="Vostok.Tools.GitCommit2AssemblyTitle.GitCommit2AssemblyTitle" AssemblyFile="$(TaskAssembly)" />

  <Target Name="GenerateAssemblyTitle" BeforeTargets="BeforeBuild">
    <GetAssemblyIdentity AssemblyFiles="$(TargetPath)">
      <Output
        TaskParameter="Assemblies"
        ItemName="MyAssemblyIdentities"/>
    </GetAssemblyIdentity>
    <PropertyGroup Condition="'$(Version)' == ''">
      <Version>%(MyAssemblyIdentities.Version)</Version>
    </PropertyGroup>
    <GitCommit2AssemblyTitle AssemblyVersion="$(Version)"/>
  </Target>

  <ItemGroup>
    <Compile Remove="Properties\AssemblyTitle.cs" />
    <Compile Include="Properties\AssemblyTitle.cs" />
  </ItemGroup>

</Project>
